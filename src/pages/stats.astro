---
// filepath: /mnt/World/site/src/pages/stats.astro
import MainLayout from "../layouts/MainLayout.astro";
import { GetMyHackaTimeStats, GetMyTodayCodingTime } from "../lib/hackatime";
import { getNewestTwoRepos } from "../lib/github";

const [hackaStats, todayStats, repos] = await Promise.all([
  GetMyHackaTimeStats(),
  GetMyTodayCodingTime(),
  getNewestTwoRepos(),
]);
const { human_readable_total, languages } = hackaStats?.data;
const { text } = todayStats?.data?.grand_total ?? {};
const todayTime = text || "—";
---

<MainLayout>
  <main
    class="flex min-h-screen w-full flex-col justify-between bg-gradient-to-br from-gray-950 via-gray-900 to-gray-800 p-4"
  >
    <div
      class="mb-6 rounded-xl border border-sky-700 bg-sky-950/80 p-6 text-center text-lg font-semibold text-sky-100 shadow-md"
    >
      My Coding Stats & Latest Projects
    </div>
    <div class="mb-4 flex gap-4">
      <section
        class="max-w-md flex-1 rounded-xl border border-gray-800 bg-gray-900/90 p-6 shadow-lg"
      >
        <h2 class="mb-2 text-xl font-bold text-slate-100">HackaTime Stats</h2>
        <ul class="space-y-1 text-slate-300">
          <li>
            <span class="font-semibold text-sky-400">Total Coding Time:</span>
            {human_readable_total ?? "—"}
          </li>
          <li>
            <span class="font-semibold text-sky-400">Top used Language:</span>
            {languages[0]?.name ?? "—"}
          </li>
        </ul>
        <div class="mt-4 text-slate-200">
          <span class="font-semibold text-emerald-400"
            >Today's Coding Time:</span
          >
          <span class="ml-2">{todayTime ?? "—"}</span>
        </div>
      </section>
      <section
        class="flex flex-1 cursor-pointer flex-col justify-center rounded-xl border border-gray-800 bg-gray-900/90 p-6 shadow-lg transition-all duration-300 hover:scale-105 hover:border-sky-500 hover:bg-gray-900/95 hover:shadow-2xl"
      >
        <h2 class="mb-2 text-xl font-bold text-slate-100">
          Latest GitHub Repos
        </h2>
        <ul class="space-y-2">
          {
            repos.map(
              (repo: {
                html_url: string;
                name: string;
                description: string;
              }) => (
                <li>
                  <a
                    href={repo.html_url}
                    target="_blank"
                    rel="noopener"
                    class="font-semibold text-sky-400 hover:underline"
                  >
                    {repo.name}
                  </a>
                  <div class="text-sm text-slate-400">
                    {repo.description ?? "No description"}
                  </div>
                </li>
              ),
            )
          }
        </ul>
      </section>
    </div>
    <section
      class="w-full cursor-pointer rounded-xl border border-gray-800 bg-gray-900/90 p-6 shadow-lg transition-all duration-300 hover:scale-105 hover:border-sky-500 hover:bg-gray-900/95 hover:shadow-2xl"
    >
      <h2 class="mb-2 text-xl font-bold text-slate-100">
        More Stats Coming Soon
      </h2>
      <p class="text-slate-300">
        Stay tuned for more coding stats, graphs, and fun data visualizations!
      </p>
    </section>
  </main>
</MainLayout>
